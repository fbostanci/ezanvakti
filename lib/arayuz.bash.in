#
#
#                           Ezanvakti Gelişmiş Arayüz  Bileşeni 2.0
#
#
#set -x
# TODO: 2.0 için yapılacaklar
# haftalık ve aylık vakitler çıktılarını göstermeyi ekle.@TMM
# dini günler gösterimini ekle.@TMM
# ana betik bağımlığını azalt . Ortak yeni fonksiyonlar yaz.@TMM
# Çoklu çalışmayı engelle.@TMM
# sistem tepsisi desteği .(?)
# arayüzde html kod denemeleri.@TMM

. @libdir@/@AD@/temel_islevler.bash
. @libdir@/@AD@/arayuz_temel.bash

# Yalnıca bir arayüz örneği çalışması için
# pid denetimi yapılsın.
arayuz_pid_denetle

bilesen_yukle mplayer_yonetici

elx=''
for ((i=1; i<=ARAYUZ_CIZGI_UZUNLUGU; i++))
{
  elx+="${ARAYUZ_CIZGI_SIMGESI}"
}

(( GUN_ANIMSAT )) && {
  if grep -q $(date +%d.%m.%Y) ${VERI_DIZINI}/veriler/gunler
  then
      ozel_ileti="\n\nBugün:  <b>$(grep $(date +%d.%m.%Y) ${VERI_DIZINI}/veriler/gunler | cut -d' ' -f2-)</b>"
  elif grep -q $(date -d 'tomorrow' +%d.%m.%Y) ${VERI_DIZINI}/veriler/gunler
  then
      ozel_ileti="\n\nYarın:  <b>$(grep $(date -d 'tomorrow' +%d.%m.%Y) ${VERI_DIZINI}/veriler/gunler | cut -d' ' -f2-)</b>"
  else
      ozel_ileti=''
  fi
}

function arayuz() {
  g_vakitleri_al

  local strng donus str str2

strng=$(yad --form --text "$(printf "${GELISMIS_ARAYUZ_BICIMI}" \
  "<span foreground=\'${ARAYUZ_TARIH_SAAT_RENGI}\'>${TARIH}</span>" \
  "<span foreground=\'${ARAYUZ_TARIH_SAAT_RENGI}\'>$(date +%H:%M:%S)</span>" \
  "<span foreground=\'${ARAYUZ_KONUM_RENGI}\'>${ILCE} / ${ULKE}</span>" \
  "<span foreground=\'${ARAYUZ_CIZGI_RENGI}\'>${elx}</span>" \
  "<span foreground=\'${ARAYUZ_SIMDIKI_VAKIT_RENGI}\'>${vakit_bilgisi}${ozel_ileti}</span>" \
  "<span foreground=\'${ARAYUZ_CIZGI_RENGI}\'>${elx}</span>" "$(g_vakitleri_yaz)" \
  "<span foreground=\'${ARAYUZ_KALAN_SURE_RENGI}\'>${v_ileti}</span>" \
  "<span foreground=\'${ARAYUZ_KALAN_SURE_RENGI}\'>${v_kalan}</span>")" \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Ezanlar</span>:CB" \
'!Sabah!Öğle!İkindi!Akşam!Yatsı' \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Sureler</span>:CB" \
"!000-Özel Pencere$sure_listesi" \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Seçimler</span>:CB" \
${secim_listesi} \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Başlatıcı</span>:CE" \
"${tamamlama_listesi}" --button='gtk-ok:150' --button="gtk-close:121" \
--image=${VERI_DIZINI}/simgeler/ezanvakti.png --window-icon=${VERI_DIZINI}/simgeler/ezanvakti2.png \
--title "${AD^} $SURUM" --center --fixed)

donus=$(echo $?)

declare -x $(echo "$strng" | sed 's:|: :g' | gawk '{print "str="$1 "\nstr2="$2}')

[[ -n $str2 ]] && arayuz

if (( $donus == 150 ))
then
    if [[ $str = Sabah ]]
    then
            mplayer_ileti=" Sabah ezanı dinletiliyor..\n\n Okuyan : ${EZAN_OKUYAN}"
            mplayer_calistir "${SABAH_EZANI}" &
            pencere_bilgi; arayuz

    elif [[ $str = Öğle ]]
    then
            mplayer_ileti=" Öğle ezanı dinletiliyor..\n\n Okuyan : ${EZAN_OKUYAN}"
            mplayer_calistir "${OGLE_EZANI}" &
            pencere_bilgi; arayuz

    elif [[ $str = İkindi ]]
    then
            mplayer_ileti=" İkindi ezanı dinletiliyor..\n\n Okuyan : ${EZAN_OKUYAN}"
            mplayer_calistir "${IKINDI_EZANI}" &
            pencere_bilgi; arayuz

    elif [[ $str = Akşam ]]
    then
            mplayer_ileti=" Akşam ezanı dinletiliyor..\n\n Okuyan : ${EZAN_OKUYAN}"
            mplayer_calistir "${AKSAM_EZANI}" &
            pencere_bilgi; arayuz

    elif [[ $str = Yatsı ]]
    then
            mplayer_ileti=" Yatsı ezanı dinletiliyor..\n\n Okuyan : ${EZAN_OKUYAN}"
            mplayer_calistir "${YATSI_EZANI}" &
            pencere_bilgi; arayuz

    elif [[ $str = Ayet ]]
    then
            secim_basligi='Günlük Ayet'
            bilesen_yukle ayet_goster
            ayet_goster ucbirim > /tmp/ezanvakti-6
            g_secim_goster;arayuz

    elif [[ $str = Hadis ]]
    then
            secim_basligi='40 Hadis'
            bilesen_yukle bilgi_goster
            hadis_goster ucbirim > /tmp/ezanvakti-6
            g_secim_goster;arayuz

    elif [[ $str = Esma-ül Hüsna ]]
    then
            secim_basligi='Esma-ül Hüsna'
            bilesen_yukle bilgi_goster
            esma_goster ucbirim > /tmp/ezanvakti-6
            g_secim_goster;arayuz

    elif [[ $str = Bilgi ]]
    then
            secim_basligi='Dini Bilgiler'
            bilesen_yukle bilgi_goster
            bilgi_goster ucbirim > /tmp/ezanvakti-6
            g_secim_goster;arayuz

    elif [[ $str = Günlük Vakitler ]]
    then
            secim_basligi='Günlük Vakitler'
            bilesen_yukle vakitleri_goster
            vakitler tum_vakitler > /tmp/ezanvakti-6
            g_secim_goster; arayuz

    elif [[ $str = Aylık Vakitler ]]
    then
            secim_basligi='Aylık Vakitler'
            bilesen_yukle vakitleri_goster
            vakitler aylik > /tmp/ezanvakti-6
            g_secim_goster; arayuz

    elif [[ $str = Haftalık Vakitler ]]
    then
            secim_basligi='Haftalık Vakitler'
            bilesen_yukle vakitleri_goster
            vakitler haftalik > /tmp/ezanvakti-6
            g_secim_goster; arayuz

    elif [[ $str = @(Kerahat Vakitleri|Kerahat) ]]
    then
            secim_basligi='Kerahat Vakitleri'
            bilesen_yukle kerahat
            kerahat_vakitleri ucbirim > /tmp/ezanvakti-6
            g_secim_goster; arayuz

    elif [[ $str = Dini Günler ve Geceler ]]
    then
            secim_basligi="$(date +%Y) Dini Günler ve Geceler"
            bilesen_yukle dini_gunler
            gunler > /tmp/ezanvakti-6
            g_secim_goster; arayuz

    elif [[ $str = @(Ayarlar|yapilandirma|Yapılandırma Yöneticisi)  ]]
    then
            bilesen_yukle yapilandirma_yoneticisi
            yapilandirma

    elif [[ $str = özel pencere ]]
    then
            ozel_pencere

    elif [[ $str = güncelle ]]
    then
            bilesen_yukle guncelleyici
            guncelleme_yap; arayuz

    elif [[ $str = @(hakkında|about) ]]
    then
            bilesen_yukle hakkinda
            g_hakkinda; arayuz

    elif [[ $str = arayuz2 ]]
    then
            bilesen_yukle arayuz2
            arayuz2; arayuz

    elif [[ $str = yardım ]]
    then
            bilesen_yukle kullanim
            betik_kullanimi > /tmp/ezanvakti-6
            sed -i '$d' /tmp/ezanvakti-6
            g_secim_goster; arayuz

    elif [[ $(grep [0-9] <<<$str) ]]
    then
            sure=$(cut -d'-' -f1 <<<$str)

        if [[ $sure = 000 ]]
        then
            ozel_pencere
        else
            if [[ -f "${YEREL_SURE_DIZINI}/$sure.mp3" ]]
            then
                okuyan='Yerel Okuyucu'

            elif [[ ${OKUYAN} = AlGhamdi ]]
            then
                okuyan="Saad el Ghamdi"

            elif [[ ${OKUYAN} = AsShatree ]]
            then
                okuyan="As Shatry"

            elif [[ ${OKUYAN} = AlAjmy ]]
            then
                okuyan="Ahmad el Ajmy"
            fi
        fi

        bilesen_yukle kuran_dinletici
        mplayer_ileti="$(gawk -v sira=$sure '{if(NR==sira) print $4;}' < ${VERI_DIZINI}/veriler/sure_bilgisi)"
        mplayer_ileti+=" suresi dinletiliyor..\n\n Okuyan : ${okuyan}"

        pencere_bilgi &
        kuran_dinlet secim $sure
        pkill yad >/dev/null 2>&1; arayuz

    else
        arayuz
    fi

elif (( $donus == 121 ))
then
    exit 0
fi
};arayuz

# vim: set ft=sh ts=2 sw=2 et:
